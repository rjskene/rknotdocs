

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sizing &mdash; RKnot  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"equationNumbers": {"autoNumber": "AMS", "useLabelIds": true}}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SIR: Factors Influencing Spread" href="sir.html" />
    <link rel="prev" title="Key Concepts" href="concepts.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> RKnot
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">ARCHITECTURE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="theory.html">Viral Spread Theory in RKnot</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Key Concepts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sizing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Contact-Rates">Contact Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Impact-of-Density">Impact of Density</a></li>
<li class="toctree-l2"><a class="reference internal" href="#SIR:-Measuring-Contact-Rates">SIR: Measuring Contact Rates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#We-find-that-all-the-dots-in-the-sim-had-a-mean-contact-rate-near-1-(as-expected)-and-variance-near-1.">We find that all the dots in the sim had a mean contact rate near 1 (as expected) and variance near 1.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#SIR:-Confirming-R_0">SIR: Confirming <span class="math notranslate nohighlight">\(R_0\)</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="#SIR:-Impact-of-Changes-in-Mover-Function">SIR: Impact of Changes in Mover Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Customization">Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#TMR75">TMR75</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">SIMULATIONS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sir.html">SIR: Factors Influencing Spread</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RKnot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Sizing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sizing.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Sizing">
<h1>Sizing<a class="headerlink" href="#Sizing" title="Permalink to this headline">¶</a></h1>
<p>Appropriate sizing of a simulation environment is more art than science but we can use several tools in the <strong>RKnot</strong> package and the scientific literature to approximate appropriate attributes and initial conditions.</p>
<p>To summarize, our approach to sizing is as follows:</p>
<ol class="arabic simple">
<li><p>Contact rate should follow a gamma distribution as defined in the <a class="reference external" href="https://www.medrxiv.org/content/10.1101/2020.08.07.20169920v3.full.pdf">Hutch model</a>.</p></li>
<li><p>Aim for mean and variance of contact rate as outlined in the Hutch model.</p></li>
<li><p><span class="math notranslate nohighlight">\(R_0\)</span> distribution should replicate the <a class="reference external" href="https://wellcomeopenresearch.org/articles/5-67#ref-12">Endo distribution</a>.</p></li>
<li><p>Favor more Events over greater density.</p></li>
</ol>
<p>Detailed and justified further below.</p>
<p>Thus, in order to appropriately size, we must be able to measure:</p>
<ol class="arabic simple">
<li><p>the contact rate of an environment during the initial infection duration</p></li>
<li><p>the <span class="math notranslate nohighlight">\(R_0\)</span> of an environment</p></li>
</ol>
<div class="section" id="Contact-Rates">
<h2>Contact Rates<a class="headerlink" href="#Contact-Rates" title="Permalink to this headline">¶</a></h2>
<p>The contact rate of indiviudals and the broader population is fundamentally important to the <span class="math notranslate nohighlight">\(R_0\)</span> of a virus. All else equal, an infected individual will likely cause more secondary infections if they have more contacts.</p>
<p>Equally important are both the timing and distribution of contacts around the mean. The Hutch model uses a gamma distribution to generate contact regimes using mean and variance parameters to shape:</p>
<div class="math notranslate nohighlight">
\[c_t\;\approx\;\Gamma(\frac{\mu}{\rho}, {\rho})\]</div>
<p><strong>RKnot</strong> tends to most reliabily replicate the SIR model in the <a class="reference internal" href="sir.html#1.-Equal"><span class="std std-ref">Equal Mover scenario</span></a>.</p>
<p>We ran 1,000 iterations of that scenario to investigate the contact distribution.</p>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p>These iterations resulted in a mean contact rate of 0.9973 and a variance of 0.9731. We can see the distribution of the contacts per day in the histogram below.</p>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_5_0.png" src="_images/sizing_5_0.png" />
</div>
</div>
<p>The distribution reveals that on <em>about a third of all days</em> the infected subject had no contacts at all. And on a third of all days the infected had a single contact. And remaining days had more, including a single day where an infected had 8 contacts.</p>
<p>And it just so happens this distribution fits the Hutch gamma quite well, as per below:</p>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_7_0.png" src="_images/sizing_7_0.png" />
</div>
</div>
<p>With 0 contacts per day accounting for such a high proportion of days, it is likely that even in the SIR model many infected subjects do not cause <em>any</em> secondary infections.</p>
<p>Below we show the number of secondary infections caused be each single infected subject.</p>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_9_0.png" src="_images/sizing_9_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p>In the chart on the left, we see the number of secondary infections created in each iteration of the Equal mover scenario. In 7.80% of all outcomes, the infected subject doesn’t infect anyone at all.</p>
</div>
</div>
<p>We can also see that the distribution of <span class="math notranslate nohighlight">\(R_0\)</span> values in the SIR model fits the standard binomial distribution quite well.</p>
<p>This is acutally a shortcoming of the SIR model. In the real world, viral transmission has been shown to function as a negative binomial distribution, where both 0 and much larger outcomes tend to occur far more often.</p>
<p>So with a negative binomial, we would expect that a large proportion of infected subjects will not infect anyone at all and a small number of infected subjects will infect a large number of people.</p>
<p><a class="reference external" href="https://wellcomeopenresearch.org/articles/5-67#ref-12">Endo et al</a> provides an estimate of the scaling factor for sars-cov-2 and suggests that <em>&gt;70% of all primary infections result in 0 secdonary infections</em>.</p>
<p>We can see the distribution of the Equal scenario versus the Endo distribution in the plot on the right above. Clearly, there is a poor fit. So, if we are to more accurately reflect the spread of sars-cov-2, we must attempt to replicate the Endo distribution of secondary cases in our environments.</p>
</div>
<div class="section" id="Impact-of-Density">
<h2>Impact of Density<a class="headerlink" href="#Impact-of-Density" title="Permalink to this headline">¶</a></h2>
<p>There are only two ways (presently) that <strong>RKnot</strong> can increase the contact rate in an environment.</p>
<ol class="arabic simple">
<li><p>Increased density</p></li>
<li><p>Events</p></li>
</ol>
<p><em>In the future, contact rate can also be increased by allowing for more ticks per day.</em></p>
<p>The impact of population density on viral spread in the real word is more nuanced than one might expect. With respect to sars-cov-2, for example, <a class="reference external" href="https://www.medrxiv.org/content/10.1101/2020.08.21.20179416v2">studies</a> have found anywhere from zero to weak to strong correlations. Certainly at a country level population density doesn’t <a class="reference external" href="https://ourworldindata.org/grapher/covid-19-death-rate-vs-population-density">appear to have much correlation to covid-19 case counts</a>.</p>
<p>Still, all else equal, in so far as population density leads to more contacts we would expect it to lead to greater spread.</p>
<p>In <strong>RKnot</strong>, population density has exactly that effect.</p>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p>With a density of 5, the resulting mean contact rate is 4.9436 with a variance of 4.9607.</p>
</div>
</div>
<p>If we plot the distribution of contacts in a histogram, we see that the peaks have shifted such that far fewer days result in 0 contacts (compared to density 1 above).</p>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_16_0.png" src="_images/sizing_16_0.png" />
</div>
</div>
<p>And we see that the distribution doesn’t even sniff Gamma:</p>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_18_0.png" src="_images/sizing_18_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binom</span><span class="p">,</span> <span class="n">nbinom</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">counts</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">rwidth</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="mf">2.5</span><span class="o">/</span><span class="mi">14</span>
<span class="n">binom_f</span> <span class="o">=</span> <span class="n">binom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">+.</span><span class="mi">5</span><span class="p">,</span> <span class="n">binom_f</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">+.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">binom_f</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Binomial&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="n">xmax</span> <span class="o">=</span> <span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span><span class="o">+.</span><span class="mi">5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmax</span><span class="p">)])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmax</span><span class="p">)])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Secondary Infections&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability of Occurence&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">R0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1"> Simulations&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">R0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> days per sim&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> mean R0&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> R0 variance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

<span class="n">counts</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">rwidth</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">+.</span><span class="mi">5</span><span class="p">,</span> <span class="n">endoarr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">+.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">endoarr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">R0</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Endo&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">contacts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1"> Simulations of the SIR Equal Mover Scenario with Density of </span><span class="si">{</span><span class="n">testdens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_19_0.png" src="_images/sizing_19_0.png" />
</div>
</div>
</div>
<div class="section" id="SIR:-Measuring-Contact-Rates">
<h2>SIR: Measuring Contact Rates<a class="headerlink" href="#SIR:-Measuring-Contact-Rates" title="Permalink to this headline">¶</a></h2>
<p>So, with a framework for optimizing contact rates, we must now figure out how to measure contact rates and R0 in our simulations.</p>
<p><a class="reference external" href="#Contact-Rates">We have seen mathematically</a> that a density of 1 dot per location should result in a mean contact rate of ~1 per day.</p>
<p>Below, we will investigate if that is the case.</p>
<p>We will assume:</p>
<ul class="simple">
<li><p>population of 10,000</p></li>
<li><p>simulation length of 14 days (equal to the infection duration)</p></li>
<li><p>density of 1</p></li>
<li><p><span class="math notranslate nohighlight">\(R_0\)</span> of 2.5</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rknot</span> <span class="kn">import</span> <span class="n">Sim</span>

<span class="n">group</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">n_inf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ifr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">mover</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">R0</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
    <span class="n">infdur</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>When running the sim, we set <code class="docutils literal notranslate"><span class="pre">dotlog=True</span></code>. The <code class="docutils literal notranslate"><span class="pre">dotlog</span></code> is a 3d record of the dot matrix at each tick in the simulation.</p>
<p><em>``dotlog`` defaults to ``False`` as it can impact performance for large populations and longer simulations.</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "32fa40aadfc04154a0b9ed47d93558d8", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p>Upon completion of the sim, an attribute <code class="docutils literal notranslate"><span class="pre">dotlog</span></code> has been added. We can see it has shape (14, 10000, 23), corresponding to 14 ticks, 10,000 dots, and the 23 attributes in the dot matrix.</p>
</div>
</div>
<p>The initial infected dot is chosen at random, so we cannot isolate and track its movements ahead of time. But we <em>can</em> isolate it in the first first frame of the <code class="docutils literal notranslate"><span class="pre">dotlog</span></code> and review its entire history in the sim.</p>
<p>We show the first four ticks below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">rknot.dots.matrix</span> <span class="kn">import</span> <span class="n">ML</span><span class="p">,</span> <span class="n">MLNB</span>

<span class="n">i_inf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="n">ML</span><span class="p">[</span><span class="s1">&#39;is_inf&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:,</span> <span class="n">i_inf</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[5060,    0,    1,    0,    0,    1,    1, 8767,   88,   68, 6889,
          69,   90,    0,    0,   -1,    0,  100,    0,    0,   -1,   15,
         381],
       [5060,    0,    1,    0,    0,    1,    1, 6911,   70,   12, 6889,
          69,   90,    0,    0,   -1,    0,  100,    0,    0,   -1,   15,
         381],
       [5060,    0,    1,    0,    0,    1,    1, 9498,   95,   99, 6889,
          69,   90,    0,    0,   -1,    0,  100,    0,    0,   -1,   15,
         381],
       [5060,    0,    1,    0,    0,    1,    1, 1855,   19,   56, 6889,
          69,   90,    0,    0,   -1,    0,  100,    0,    0,   -1,   15,
         381]])
</pre></div></div>
</div>
<p>We can then determine which locations the dot visited at each tick.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">locs_visited</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:,</span> <span class="n">i_inf</span><span class="p">,</span> <span class="n">ML</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">locs_visited</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([8767, 6911, 9498, 1855, 6004, 1209, 6538, 9566, 9906, 5004, 7797,
        680, 9648, 5393])
</pre></div></div>
</div>
<p>Next, find how many total dots were at the same location at the same time as the initial infected.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dots_at_loc</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:,:,</span><span class="n">ML</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">locs_visited</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">dots_at_loc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([3, 2, 4, 3, 1, 2, 1, 2, 4, 1, 1, 2, 2, 1])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p>The array above tells us there we 3 dots at location id 8767 on the first tick, 2 dots at location id 6911 on the second tick, etc.</p>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ML</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;locs_visited1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">dots_at_loc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ML</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;locs_visited1&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">dots_at_loc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Next, we subtract 1 from <code class="docutils literal notranslate"><span class="pre">dots_at_loc</span></code> since a contact constitutes two or more dots. Then find the mean and variance of the infected dot’s daily contacts.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">contacts</span> <span class="o">=</span> <span class="n">dots_at_loc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="n">UPDATEDB</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="s1">&#39;mean, var 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">contacts</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">contacts</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;mean, var 1&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.07 1.07
</pre></div></div>
</div>
<p>On average, the contacts of the infected dot during the infection period are as expected.</p>
<p>From the contact distribution below, we can see that the majority of days, an infected dot had 0 or 1 contact.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">counts</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">contacts</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Contacts per Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_41_0.png" src="_images/sizing_41_0.png" />
</div>
</div>
<p>For a larger sample, we can repeat the above process for every dot in the simulation. The <code class="docutils literal notranslate"><span class="pre">find_all_contacts</span></code> method loops through every dot in the dotlog and finds the number of contacts for each dot.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rknot.dots.matrix</span> <span class="kn">import</span> <span class="n">MLNB</span>

<span class="n">all_contacts</span> <span class="o">=</span> <span class="n">find_all_contacts</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="mi">14</span><span class="p">],</span> <span class="n">MLNB</span><span class="p">)</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="n">UPDATEDB</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="s1">&#39;mean, var 3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">all_contacts</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">all_contacts</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;mean, var 3&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_45_0.png" src="_images/sizing_45_0.png" />
</div>
</div>
<div class="section" id="We-find-that-all-the-dots-in-the-sim-had-a-mean-contact-rate-near-1-(as-expected)-and-variance-near-1.">
<h3>We find that all the dots in the sim had a mean contact rate near 1 (as expected) and variance near 1.<a class="headerlink" href="#We-find-that-all-the-dots-in-the-sim-had-a-mean-contact-rate-near-1-(as-expected)-and-variance-near-1." title="Permalink to this headline">¶</a></h3>
<p>Yet another approach is to iterate over a number of different sims and look for the mean and variance of contacts for the infected dot across those sims.</p>
<p><em>Sim allows the server and worker processes to be recycled (by passing ``server`` and ``workers`` attributes. This results in faster runtime as the Numba functions need only be loaded once during the first iteration for each server/worker</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">trange</span>

<span class="n">days</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R0&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;infdur&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">:</span> <span class="n">days</span><span class="p">}</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">contacts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">days</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pbar_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pbar_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">inf_contacts</span> <span class="o">=</span> <span class="n">contacts_of_init_inf</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">)</span>
    <span class="n">contacts</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">days</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="n">days</span> <span class="o">+</span> <span class="n">days</span><span class="p">]</span> <span class="o">=</span> <span class="n">inf_contacts</span>

<span class="n">mean</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9632189791744e5892ec9a58822c0e65", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="n">UPDATEDB</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="s1">&#39;mean, var 4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">contacts</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">contacts</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;mean, var 4&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Above we see that the infected dot averaged close to 1 contact per day with a variance of ~1 contact per day.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mean</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9946428571428572
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">mean</span><span class="o">/</span><span class="n">var</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">var</span>
<span class="n">rv</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">40</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">counts</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">contacts</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;frozen pdf&#39;</span><span class="p">)</span>

<span class="n">xmax</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmax</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmax</span><span class="p">)])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Mean: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#3977af&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Variance: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#3977af&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Contacts per Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;imgs/contact_pdf_equal_mover.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_51_0.png" src="_images/sizing_51_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="SIR:-Confirming-R_0">
<h2>SIR: Confirming <span class="math notranslate nohighlight">\(R_0\)</span><a class="headerlink" href="#SIR:-Confirming-R_0" title="Permalink to this headline">¶</a></h2>
<p>We can similarly use the dotlog to confirm that the simulation results in the correct level of <span class="math notranslate nohighlight">\(R_0\)</span>, whether passed explicitly or implied through other parameters.</p>
<p>We can measure the <em>expected</em> <span class="math notranslate nohighlight">\(R_0\)</span> of an infected dot, in any environment, by determining its number of contacts and then multiplying those contacts by the tranmission risk at the time of the contacts. This results in the expected number of transmissions per day, which is then summed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">R0</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
    <span class="n">infdur</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">group</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">n_inf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ifr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">mover</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "501737b2780f438fa13bf6e9956e43c8", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">contacts</span> <span class="o">=</span> <span class="n">find_all_contacts</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="n">sim</span><span class="o">.</span><span class="n">tmrs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">MLNB</span><span class="p">)</span>
<span class="n">contacts_by_dot</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">tmrs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">eR0_by_dot</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">tmrs</span> <span class="o">*</span> <span class="n">contacts_by_dot</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eR0_by_dot</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.566928571428568
</pre></div></div>
</div>
<p>So based on the actual contacts had by each dot in the environment, we would expect any particular dot to create ~2.5 secondary infections, equivalent to <span class="math notranslate nohighlight">\(R_0\)</span> of 2.5.</p>
<p>With that in mind, we can investigate the true number of secondary infections by using the <code class="docutils literal notranslate"><span class="pre">sterile</span></code> flag. When <code class="docutils literal notranslate"><span class="pre">sterile=True</span></code>, the sim determines which subjects should be infected for each contact via <code class="docutils literal notranslate"><span class="pre">_infect_select</span></code>, but does <em>not</em> call the <code class="docutils literal notranslate"><span class="pre">_infect</span></code> method afterwards.</p>
<p>So no new dots are ever actually infected, but we can still track the number of dots that were <em>selected</em> for infection via <code class="docutils literal notranslate"><span class="pre">sim.log[n_sec]</span></code>.</p>
<p>Thus, if <code class="docutils literal notranslate"><span class="pre">n_inf=1</span></code>, <code class="docutils literal notranslate"><span class="pre">sim.log[n_sec]</span></code> gives us the idealized outcome of an infected subject in an entirely sesceptible popualtion.</p>
<p>The sim terminates once the single infected dot recovers.</p>
<p>First, we can use <code class="docutils literal notranslate"><span class="pre">find_all_contacts</span></code> to estimate the mean number of secondary infections we would expect across multiple simulations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[169]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rknot.helpers</span> <span class="kn">import</span> <span class="n">find_n_sec</span>

<span class="k">def</span> <span class="nf">looper</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">sterile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">R0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">infdur</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tmr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">tmr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">infdur</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;days&#39;</span><span class="p">:</span> <span class="n">days</span><span class="p">,</span> <span class="s1">&#39;inf_curve&#39;</span><span class="p">:</span> <span class="n">tmr</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;R0&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;infdur&#39;</span><span class="p">:</span> <span class="n">infdur</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">:</span> <span class="n">days</span><span class="p">}</span>

    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">density</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sterile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sterile</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;get_attrs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span>

    <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">events</span>

    <span class="n">contacts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">infdur</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">w_nsecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">nsec_cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">nsecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">infdur</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pbar_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pbar_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">tmrs</span> <span class="o">=</span> <span class="n">tmr</span> <span class="k">if</span> <span class="n">tmr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sim</span><span class="o">.</span><span class="n">tmrs</span>

        <span class="n">w_nsecs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nsec_cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_n_sec</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="n">infdur</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">tmrs</span><span class="p">)</span>
        <span class="n">inf_contacts</span> <span class="o">=</span> <span class="n">contacts_of_init_inf</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="n">infdur</span><span class="p">])</span>
        <span class="n">contacts</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">infdur</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="n">infdur</span> <span class="o">+</span> <span class="n">infdur</span><span class="p">]</span> <span class="o">=</span> <span class="n">inf_contacts</span>
        <span class="n">nsecs</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">infdur</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="n">infdur</span> <span class="o">+</span> <span class="n">infdur</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;n_sec&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">nsecs</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[170]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">density</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">infdur</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">infdur</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">R0</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">w_nsecs</span><span class="p">,</span> <span class="n">nsec_cs</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">nsecs</span> <span class="o">=</span> <span class="n">looper</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="n">R0</span><span class="p">,</span> <span class="n">infdur</span><span class="o">=</span><span class="n">infdur</span><span class="p">)</span>

<span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span> <span class="o">=</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">eR0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">infdur</span><span class="p">)</span><span class="o">*</span><span class="n">sim</span><span class="o">.</span><span class="n">tmrs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">nsecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">infdur</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e054bc6e75cf4476a43b50894d62c0fe", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-170-610eab09fee8&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> days <span class="ansi-blue-fg">=</span> infdur <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> R0 <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">2.5</span>
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg"> </span>w_nsecs<span class="ansi-blue-fg">,</span> nsec_cs<span class="ansi-blue-fg">,</span> contacts<span class="ansi-blue-fg">,</span> nsecs <span class="ansi-blue-fg">=</span> looper<span class="ansi-blue-fg">(</span>n<span class="ansi-blue-fg">,</span> density<span class="ansi-blue-fg">,</span> days<span class="ansi-blue-fg">,</span> group<span class="ansi-blue-fg">,</span> R0<span class="ansi-blue-fg">=</span>R0<span class="ansi-blue-fg">,</span> infdur<span class="ansi-blue-fg">=</span>infdur<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> mean_ktr<span class="ansi-blue-fg">,</span> var_ktr <span class="ansi-blue-fg">=</span> contacts<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> contacts<span class="ansi-blue-fg">.</span>var<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-169-b5f4cca73aaf&gt;</span> in <span class="ansi-cyan-fg">looper</span><span class="ansi-blue-fg">(n, density, days, groups, sterile, R0, infdur, tmr, attrs, events)</span>
<span class="ansi-green-intense-fg ansi-bold">     31</span>             sim<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span>dotlog<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> pbar_on<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> kill<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     32</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 33</span><span class="ansi-red-fg">             </span>sim<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span>dotlog<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> pbar_on<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> kill<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span>
<span class="ansi-green-intense-fg ansi-bold">     35</span>         tmrs <span class="ansi-blue-fg">=</span> tmr <span class="ansi-green-fg">if</span> tmr <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> sim<span class="ansi-blue-fg">.</span>tmrs

<span class="ansi-green-fg">~/Documents/programming/rknot/rknot/sim.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self, num_ticks, pbar_on, pbar_leave, dotlog, kill, print_clock)</span>
<span class="ansi-green-intense-fg ansi-bold">    304</span>                     pbar<span class="ansi-blue-fg">.</span>set_postfix<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    305</span>
<span class="ansi-green-fg">--&gt; 306</span><span class="ansi-red-fg">             </span>over <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>next<span class="ansi-blue-fg">(</span>print_clock<span class="ansi-blue-fg">=</span>print_clock<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    307</span>
<span class="ansi-green-intense-fg ansi-bold">    308</span>             <span class="ansi-green-fg">if</span> dotlog<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/Documents/programming/rknot/rknot/sim.py</span> in <span class="ansi-cyan-fg">next</span><span class="ansi-blue-fg">(self, print_clock)</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>         ray<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>worker<span class="ansi-blue-fg">.</span>work<span class="ansi-blue-fg">.</span>remote<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>i_tick<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> worker <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>workers<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    273</span>         end2 <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 274</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>infected<span class="ansi-blue-fg">,</span> over <span class="ansi-blue-fg">=</span> ray<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>server<span class="ansi-blue-fg">.</span>transmit2<span class="ansi-blue-fg">.</span>remote<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    275</span>         end3 <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    276</span>

<span class="ansi-green-fg">~/Documents/programming/envs/rknotenv/lib/python3.8/site-packages/ray/actor.py</span> in <span class="ansi-cyan-fg">__getattr__</span><span class="ansi-blue-fg">(self, item)</span>
<span class="ansi-green-intense-fg ansi-bold">    741</span>     <span class="ansi-green-fg">def</span> __getattr__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> item<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    742</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>_ray_is_cross_language<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 743</span><span class="ansi-red-fg">             raise AttributeError(&#34;&#39;{}&#39; object has no attribute &#39;{}&#39;&#34;.format(
</span><span class="ansi-green-intense-fg ansi-bold">    744</span>                 type(self).__name__, item))
<span class="ansi-green-intense-fg ansi-bold">    745</span>         <span class="ansi-green-fg">if</span> item <span class="ansi-green-fg">in</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;__ray_terminate__&#34;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;__ray_checkpoint__&#34;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">AttributeError</span>: &#39;ActorHandle&#39; object has no attribute &#39;transmit2&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="n">nsec_cs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">==</span> <span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">infdur</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">mean_nsec</span><span class="p">,</span> <span class="n">mean_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.008 0.9896502857142858
0.0 1.008
2.4947999999999944 2.56
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;We see here that, across </span><span class="si">{}</span><span class="s1"> sims, the $R_0$ is &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;within </span><span class="si">{:.0%}</span><span class="s1"> of expected R0 based on contacts. &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">R0</span> <span class="o">/</span> <span class="n">eR0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">md</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<p>We see here that, across 250 sims, the <span class="math notranslate nohighlight">\(R_0\)</span> is within 3% of expected R0 based on contacts.</p>
</div>
</div>
</div>
<div class="section" id="SIR:-Impact-of-Changes-in-Mover-Function">
<h2>SIR: Impact of Changes in Mover Function<a class="headerlink" href="#SIR:-Impact-of-Changes-in-Mover-Function" title="Permalink to this headline">¶</a></h2>
<p>With the veracity of the SIR model and the assessment process confirmed, we can check the impact of changes to various attributes of the sim, including the <code class="docutils literal notranslate"><span class="pre">mover</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">group</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">n_inf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ifr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">mover</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">infdur</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">infdur</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;R0&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;infdur&#39;</span><span class="p">:</span> <span class="n">infdur</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">:</span> <span class="n">days</span><span class="p">}</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">density</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">infdur</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">infdur</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">R0</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">w_nsecs</span><span class="p">,</span> <span class="n">nsec_cs</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">nsecs</span> <span class="o">=</span> <span class="n">looper</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="n">R0</span><span class="p">,</span> <span class="n">infdur</span><span class="o">=</span><span class="n">infdur</span><span class="p">)</span>

<span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span> <span class="o">=</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">eR0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">infdur</span><span class="p">)</span><span class="o">*</span><span class="n">sim</span><span class="o">.</span><span class="n">tmrs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">nsecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">infdur</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cb2edc281aad4b1bb498be018f9d48e1", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mean_nseccs</span> <span class="o">=</span> <span class="n">nsec_cs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">infdur</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">mean_nseccs</span> <span class="o">==</span> <span class="n">c</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mean_nseccs</span><span class="si">}</span><span class="s1"> v </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9794285714285714 1.0424339591836735
0.0 0.0
2.4240857142857095 2.528
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="s1">&#39;nsecs mean, var local&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">infdur</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">,</span> <span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">,</span> <span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">infdur</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">,</span> <span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">,</span> <span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;nsecs mean, var local&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Despite the signficant change in movement pattern, <a class="reference internal" href="sir.html#2.-Local"><span class="std std-ref">which we know results in a very different infection curve</span></a>, the <span class="math notranslate nohighlight">\(R_0\)</span> does not decline significantly. In fact, it increases.</p>
</div>
<div class="section" id="Customization">
<h2>Customization<a class="headerlink" href="#Customization" title="Permalink to this headline">¶</a></h2>
<p>We can use this testing approach to build custom simulation environments.</p>
<p>For example, in this <a class="reference external" href="https://www.medrxiv.org/content/10.1101/2020.08.07.20169920v3.full.pdf">paper</a>, the authors fit a transmission risk profile of sars-cov-2 to several properties of the environment including: + mean <span class="math notranslate nohighlight">\(R_0\)</span> of 1.8 + 4 contacts per day + 40 variance of contacts</p>
<p>RKnot’s event structure can help to simulate the required level of variance. We can import the tmr curve from <code class="docutils literal notranslate"><span class="pre">rknot.dots.fhutch</span></code>.</p>
<p>As with above, we will first investigate the expected number of contacts and secondary infections using <code class="docutils literal notranslate"><span class="pre">find_all_contacts</span></code> under the usual density of 1.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rknot.dots.fhutch</span> <span class="kn">import</span> <span class="n">tmr</span>

<span class="n">group</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">n_inf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ifr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">mover</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">density</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">infdur</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">w_nsecs</span><span class="p">,</span> <span class="n">nsec_cs</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">nsecs</span> <span class="o">=</span> <span class="n">looper</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">tmr</span><span class="o">=</span><span class="n">tmr</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c76990653a72484084268d28cc30aabc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span> <span class="o">=</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">eR0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">infdur</span><span class="p">)</span><span class="o">*</span><span class="n">tmr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">nsecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">infdur</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The expected <span class="math notranslate nohighlight">\(R_0\)</span> using density of 1 dot per subject is much lower than the 1.8 target.</p>
<p>We have two options: 1) Use events to significantly increase the number of contacts (and the variance) or, 2) increase the density.</p>
<p>We’ll start with option 1.</p>
<p>We can replicate the required contact frequency and variance quite simply using events.</p>
<p>We can maintain the density of 1 subject per location and implement a series of 100 separate events, each with a capacity of 18 subjects, and each recur daily beginning on tick 1.</p>
<p><em>Here, we will switch to our ``baseus`` simulation environment, as its size is more conducive to a higher contact variance.</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[157]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rknot.events</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">rknot.sims</span> <span class="kn">import</span> <span class="n">baseus</span>
<span class="kn">from</span> <span class="nn">rknot.helpers</span> <span class="kn">import</span> <span class="n">modulereload</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">rknot.nb</span> <span class="kn">import</span> <span class="n">funcs</span> <span class="k">as</span> <span class="n">nbf</span>

<span class="n">modulereload</span><span class="p">(</span><span class="n">baseus</span><span class="p">)</span>

<span class="n">groups</span> <span class="o">=</span> <span class="n">baseus</span><span class="o">.</span><span class="n">groups</span>
<span class="n">groups</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;n_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">density</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">square</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">square</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">nbf</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
<span class="n">loc_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;event_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">Event</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="n">loc_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">start_tick</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">recurring</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can chart the capacity of the events over time as per below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[158]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">start_tick</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">recurring</span><span class="p">)]</span>
<span class="n">caps</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">capacity</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">start_tick</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">recurring</span><span class="p">)]</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tick</span><span class="p">,</span> <span class="n">cap</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">caps</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cap</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_78_0.png" src="_images/sizing_78_0.png" />
</div>
</div>
<p>We can see the event structure proposed has limited variation, but because the density of the simulation is low, this will still lead to significant contact variance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[159]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">infdur</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">w_nsecs</span><span class="p">,</span> <span class="n">nsec_cs</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">nsecs</span> <span class="o">=</span> <span class="n">looper</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmr</span><span class="o">=</span><span class="n">tmr</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "af2b3242aeb343258b8b7eb9dfcea922", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[160]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span> <span class="o">=</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">w_nsecs</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">eR0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">infdur</span><span class="p">)</span><span class="o">*</span><span class="n">tmr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">nsecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">infdur</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.8850666666666664 64.75959032888889
0.0 0.0
1.5588820938407884 1.528
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[161]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="s1">&#39;nsecs mean, var cust2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">infdur</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">,</span> <span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">,</span> <span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">infdur</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">,</span> <span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">,</span> <span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;nsecs mean, var cust2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The chart below shows the variability of the infected dot’s contacts over time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[162]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ktr_by_day</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ktr_by_day</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Contacts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_84_0.png" src="_images/sizing_84_0.png" />
</div>
</div>
<hr class="docutils" />
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">rknot</span> <span class="kn">import</span> <span class="n">Sim</span>
<span class="kn">from</span> <span class="nn">rknot.events</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">rknot.sims</span> <span class="kn">import</span> <span class="n">baseus</span>
<span class="kn">from</span> <span class="nn">rknot.helpers</span> <span class="kn">import</span> <span class="n">modulereload</span><span class="p">,</span> <span class="n">looper</span><span class="p">,</span> <span class="n">contacts_of_init_inf</span>
<span class="kn">from</span> <span class="nn">rknot.dots.matrix</span> <span class="kn">import</span> <span class="n">MLNB</span>
<span class="kn">from</span> <span class="nn">rknot.nb</span> <span class="kn">import</span> <span class="n">funcs</span> <span class="k">as</span> <span class="n">nbf</span>
<span class="kn">from</span> <span class="nn">rknot.dots.fhutch</span> <span class="kn">import</span> <span class="n">tmr</span><span class="p">,</span> <span class="n">tmr75</span><span class="p">,</span> <span class="n">gamma</span>
<span class="n">modulereload</span><span class="p">(</span><span class="n">baseus</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="n">groups</span> <span class="o">=</span> <span class="n">baseus</span><span class="o">.</span><span class="n">groups</span>
<span class="n">groups</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;n_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">density</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">square</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">2340</span>
<span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">square</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">nbf</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
<span class="n">loc_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">event_groups</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;3n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;4n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">750</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;5n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;6n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">220</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;20n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;50n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;50n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="p">},</span>

        <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;100n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
    <span class="p">},</span>
        <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;100n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
    <span class="p">},</span>

<span class="p">]</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">event_groups</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">ns</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">n</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1"> v </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">event_groups</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]):</span>
        <span class="n">loc_idx</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">start_tick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;startargs&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">i_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">])),</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;pvals&#39;</span><span class="p">])</span>
        <span class="n">e_groups</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">][</span><span class="n">i_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Event</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">j</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="n">loc_ids</span><span class="p">[</span><span class="n">loc_idx</span><span class="p">]],</span> <span class="n">start_tick</span><span class="o">=</span><span class="n">start_tick</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">groups</span><span class="o">=</span><span class="n">e_groups</span><span class="p">,</span>
                <span class="n">capacity</span><span class="o">=</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;capacity&#39;</span><span class="p">],</span> <span class="n">recurring</span><span class="o">=</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;recurring&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">start_tick</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">recurring</span><span class="p">)]</span>
<span class="n">caps</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">capacity</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">start_tick</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">recurring</span><span class="p">)]</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tick</span><span class="p">,</span> <span class="n">cap</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">caps</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cap</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_87_0.png" src="_images/sizing_87_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">groups</span><span class="o">=</span><span class="n">baseus</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
    <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span>
    <span class="n">get_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">inf_curve</span><span class="o">=</span><span class="n">tmr</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "622d3cceea574d11accd25c67b191c28", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">contacts</span> <span class="o">=</span> <span class="n">contacts_of_init_inf</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">all_contacts</span> <span class="o">=</span> <span class="n">nbf</span><span class="o">.</span><span class="n">find_all_contacts</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">MLNB</span><span class="p">)</span>

<span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mean_ktr_all</span><span class="p">,</span> <span class="n">var_ktr_all</span> <span class="o">=</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">eR0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">tmr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">eR0_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">tmr</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr_all</span><span class="p">,</span> <span class="n">var_ktr_all</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">eR0</span><span class="p">,</span> <span class="n">eR0_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4.566666666666666 101.57888888888893
3.4734533333333335 40.443355274488894
4.432788742910466 2.2529324980234224
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rknot.helpers</span> <span class="kn">import</span> <span class="n">pickload</span><span class="p">,</span> <span class="n">picksave</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">eventfile</span> <span class="o">=</span> <span class="s1">&#39;rknot/events/eventlists&#39;</span>
<span class="c1"># structures = pickload(eventfile)dd</span>

<span class="c1"># picksave(eventfile, structures)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">infdur</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">contacts</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">looper</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmr</span><span class="o">=</span><span class="n">tmr</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0a23c39f988a4592b139061596d03d87", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">eR0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">infdur</span><span class="p">)</span><span class="o">*</span><span class="n">tmr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">nsecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">infdur</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.37 49.6531
2.48713615404826 1.6
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[166]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="s1">&#39;results_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">infdur</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">,</span> <span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">,</span> <span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">infdur</span><span class="p">,</span> <span class="n">contacts</span><span class="p">,</span> <span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">,</span> <span class="n">mean_nsec</span><span class="p">,</span> <span class="n">var_nsec</span><span class="p">,</span> <span class="n">eR0</span><span class="p">,</span> <span class="n">R0</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;results_3&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[161]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ktr_by_day</span> <span class="o">=</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ktr_by_day</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Contacts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_96_0.png" src="_images/sizing_96_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[163]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">all_contacts</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Contacts per Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_97_0.png" src="_images/sizing_97_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">groups</span><span class="o">=</span><span class="n">baseus</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
    <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span>
    <span class="n">get_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">inf_curve</span><span class="o">=</span><span class="n">tmr</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[230]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">20</span><span class="o">/</span><span class="mi">30</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rv</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;frozen pdf&#39;</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">count</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">ignored</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">xmax</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span><span class="o">+.</span><span class="mi">5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmax</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmax</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_99_0.png" src="_images/sizing_99_0.png" />
</div>
</div>
</div>
<div class="section" id="TMR75">
<h2>TMR75<a class="headerlink" href="#TMR75" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">rknot</span> <span class="kn">import</span> <span class="n">Sim</span>
<span class="kn">from</span> <span class="nn">rknot.events</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">rknot.sims</span> <span class="kn">import</span> <span class="n">baseus</span>
<span class="kn">from</span> <span class="nn">rknot.helpers</span> <span class="kn">import</span> <span class="n">modulereload</span><span class="p">,</span> <span class="n">looper</span><span class="p">,</span> <span class="n">contacts_of_init_inf</span>
<span class="kn">from</span> <span class="nn">rknot.dots.matrix</span> <span class="kn">import</span> <span class="n">MLNB</span>
<span class="kn">from</span> <span class="nn">rknot.nb</span> <span class="kn">import</span> <span class="n">funcs</span> <span class="k">as</span> <span class="n">nbf</span>
<span class="kn">from</span> <span class="nn">rknot.dots.fhutch</span> <span class="kn">import</span> <span class="n">tmr</span><span class="p">,</span> <span class="n">tmr75</span><span class="p">,</span> <span class="n">tmr725</span><span class="p">,</span> <span class="n">gamma</span>
<span class="n">modulereload</span><span class="p">(</span><span class="n">baseus</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="n">groups</span> <span class="o">=</span> <span class="n">baseus</span><span class="o">.</span><span class="n">groups</span>
<span class="n">groups</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;n_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">density</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">days</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">square</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">square</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">nbf</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
<span class="n">loc_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">event_groups</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;12n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;15n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;20n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;50n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;50n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="p">},</span>

        <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;100n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
    <span class="p">},</span>
        <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;100n&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s1">&#39;startargs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;pvals&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">&#39;recurring&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
    <span class="p">},</span>

<span class="p">]</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">event_groups</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">ns</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">n</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ns</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1"> v </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">event_groups</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]):</span>
        <span class="n">loc_idx</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">start_tick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;startargs&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">i_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">])),</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;pvals&#39;</span><span class="p">])</span>
        <span class="n">e_groups</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">][</span><span class="n">i_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Event</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">j</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="n">loc_ids</span><span class="p">[</span><span class="n">loc_idx</span><span class="p">]],</span> <span class="n">start_tick</span><span class="o">=</span><span class="n">start_tick</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">groups</span><span class="o">=</span><span class="n">e_groups</span><span class="p">,</span>
                <span class="n">capacity</span><span class="o">=</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;capacity&#39;</span><span class="p">],</span> <span class="n">recurring</span><span class="o">=</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;recurring&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">start_tick</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">recurring</span><span class="p">)]</span>
<span class="n">caps</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">capacity</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">start_tick</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">recurring</span><span class="p">)]</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tick</span><span class="p">,</span> <span class="n">cap</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">caps</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cap</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Capacity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_102_0.png" src="_images/sizing_102_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">groups</span><span class="o">=</span><span class="n">baseus</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
    <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">,</span>
    <span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">,</span>
    <span class="n">get_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">inf_curve</span><span class="o">=</span><span class="n">tmr75</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Sim</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dotlog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0562c7c36734499696a0773bfd7c096c", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-fg">(pid=25552)</span> Initializing setup ... creating boxes and gates ...
<span class="ansi-cyan-fg">(pid=25552)</span> creating 4 groups ... creating dots ... Complete.
<span class="ansi-cyan-fg">(pid=25552)</span> Setting schedule.
<span class="ansi-cyan-fg">(pid=25552)</span> Adding recurring events.
<span class="ansi-cyan-fg">(pid=25552)</span> Structing openers, closers, multis, etc.
<span class="ansi-cyan-fg">(pid=25552)</span> Set event ids and find boxes/gates
<span class="ansi-cyan-fg">(pid=25552)</span> Event Schedule Complete.

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">contacts</span> <span class="o">=</span> <span class="n">contacts_of_init_inf</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">all_contacts</span> <span class="o">=</span> <span class="n">nbf</span><span class="o">.</span><span class="n">find_all_contacts</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">dotlog</span><span class="p">[:</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">MLNB</span><span class="p">)</span>

<span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span> <span class="o">=</span> <span class="n">contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mean_ktr_all</span><span class="p">,</span> <span class="n">var_ktr_all</span> <span class="o">=</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">eR0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">tmr75</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">eR0_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">tmr75</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr</span><span class="p">,</span> <span class="n">var_ktr</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">mean_ktr_all</span><span class="p">,</span> <span class="n">var_ktr_all</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">eR0</span><span class="p">,</span> <span class="n">eR0_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
15.166666666666666 111.40555555555558
11.659306666666666 52.470094719288895
1.6697707452796815 1.7843485579006548
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ktr_by_day</span> <span class="o">=</span> <span class="n">all_contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ktr_by_day</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Contacts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_106_0.png" src="_images/sizing_106_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[166]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">all_contacts</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">all_contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">contacts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Contacts per Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/sizing_107_0.png" src="_images/sizing_107_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sir.html" class="btn btn-neutral float-right" title="SIR: Factors Influencing Spread" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="concepts.html" class="btn btn-neutral float-left" title="Key Concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, rskene

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>